# 校园论坛项目 - 完全国内部署配置方案

## 一、架构设计

```
用户 → CDN（阿里云） → 前端（OSS） → API（Nginx） → 后端（ECS） → 数据库（PostgreSQL）
```

## 二、服务器配置

### 2.1 ECS配置
- **规格：** 2核4G
- **系统：** Ubuntu 22.04 LTS
- **带宽：** 1Mbps
- **成本：** 学生¥33/月，非学生¥83/月

### 2.2 安全组
- 22（SSH）- 仅你的IP
- 80（HTTP）- 0.0.0.0/0
- 443（HTTPS）- 0.0.0.0/0

## 三、服务器环境安装

### 3.1 Node.js 18
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

### 3.2 PostgreSQL
```bash
sudo apt install -y postgresql postgresql-contrib
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### 3.3 Nginx
```bash
sudo apt install -y nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 3.4 PM2
```bash
sudo npm install -g pm2
pm2 startup
```

## 四、Nginx配置

### 4.1 后端API配置
```nginx
server {
    listen 80;
    server_name api.youruniversity.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 4.2 SSL配置
```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d api.youruniversity.com
```

## 五、数据库配置

### 5.1 创建数据库
```sql
CREATE DATABASE forum;
CREATE USER forum_user WITH PASSWORD 'your_password';
GRANT ALL PRIVILEGES ON DATABASE forum TO forum_user;
```

### 5.2 备份脚本
```bash
# 每天凌晨2点备份
0 2 * * * pg_dump -U forum_user forum > /var/backups/forum_$(date +\%Y\%m\%d).sql
```

## 六、前端部署（OSS）

### 6.1 OSS配置
1. 创建Bucket：forum-frontend
2. 开启静态网站托管
3. 配置CDN加速
4. 绑定自定义域名

### 6.2 部署命令
```bash
npm run build
ossutil cp -r dist/ oss://forum-frontend/ --update
```

## 七、后端部署

### 7.1 环境变量
```env
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://forum_user:password@localhost:5432/forum
JWT_SECRET=your_secret_key
OSS_ACCESS_KEY_ID=your_key
OSS_ACCESS_KEY_SECRET=your_secret
```

### 7.2 PM2启动
```bash
pm2 start dist/app.js --name forum-api
pm2 save
```

## 八、成本估算

### MVP阶段（学生）
- ECS：¥33/月
- OSS+CDN：¥1-15/月
- **总计：¥34-48/月**

### MVP阶段（非学生）
- ECS：¥83/月
- OSS+CDN：¥1-15/月
- **总计：¥84-98/月**

---

**文档版本：** v1.0  
**创建日期：** 2026-02-05
