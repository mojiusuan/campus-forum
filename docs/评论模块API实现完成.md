# è¯„è®ºæ¨¡å—APIå®ç°å®Œæˆ

## âœ… å®Œæˆæ—¶é—´
2026-02-06

---

## ğŸ“‹ å®ç°æ¸…å•

### 1. è¯„è®ºæ§åˆ¶å™¨ âœ…
- [x] åˆ›å»º `src/controllers/comment.controller.ts`
- [x] å®ç°è·å–è¯„è®ºåˆ—è¡¨åŠŸèƒ½
- [x] å®ç°åˆ›å»ºè¯„è®ºåŠŸèƒ½ï¼ˆæ”¯æŒå›å¤ï¼‰
- [x] å®ç°æ›´æ–°è¯„è®ºåŠŸèƒ½
- [x] å®ç°åˆ é™¤è¯„è®ºåŠŸèƒ½ï¼ˆè½¯åˆ é™¤ï¼‰

### 2. è¯„è®ºè·¯ç”± âœ…
- [x] åˆ›å»º `src/routes/comments.routes.ts`
- [x] å®šä¹‰4ä¸ªAPIè·¯ç”±
- [x] é›†æˆè®¤è¯ä¸­é—´ä»¶
- [x] æ³¨å†Œåˆ°ä¸»åº”ç”¨

### 3. åŠŸèƒ½ç‰¹æ€§ âœ…
- [x] æ”¯æŒåµŒå¥—å›å¤ï¼ˆçˆ¶å­è¯„è®ºï¼‰
- [x] æ”¯æŒåˆ†é¡µæŸ¥è¯¢
- [x] è‡ªåŠ¨æ›´æ–°å¸–å­è¯„è®ºæ•°
- [x] è‡ªåŠ¨æ›´æ–°çˆ¶è¯„è®ºå›å¤æ•°
- [x] æƒé™éªŒè¯ï¼ˆåªèƒ½ä¿®æ”¹/åˆ é™¤è‡ªå·±çš„è¯„è®ºï¼‰
- [x] è½¯åˆ é™¤æœºåˆ¶
- [x] å†…å®¹éªŒè¯ï¼ˆé•¿åº¦é™åˆ¶ï¼‰

---

## ğŸ”Œ APIæ¥å£

### 1. è·å–è¯„è®ºåˆ—è¡¨
```
GET /api/posts/:postId/comments
```

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page` - é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit` - æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰

**å“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "comments": [
      {
        "id": "uuid",
        "content": "è¯„è®ºå†…å®¹",
        "likeCount": 5,
        "replyCount": 2,
        "createdAt": "2026-02-06T...",
        "updatedAt": "2026-02-06T...",
        "user": {
          "id": "uuid",
          "username": "username",
          "avatarUrl": "https://..."
        },
        "replies": [
          {
            "id": "uuid",
            "content": "å›å¤å†…å®¹",
            "likeCount": 2,
            "createdAt": "2026-02-06T...",
            "updatedAt": "2026-02-06T...",
            "user": {
              "id": "uuid",
              "username": "username2",
              "avatarUrl": "https://..."
            }
          }
        ]
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 50,
      "totalPages": 3,
      "hasNext": true,
      "hasPrev": false
    }
  }
}
```

### 2. åˆ›å»ºè¯„è®º
```
POST /api/posts/:postId/comments
```

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "content": "è¯„è®ºå†…å®¹",
  "parentId": "uuid" // å¯é€‰ï¼Œå›å¤è¯„è®ºæ—¶ä½¿ç”¨
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "è¯„è®ºåˆ›å»ºæˆåŠŸ",
  "data": {
    "id": "uuid",
    "content": "è¯„è®ºå†…å®¹",
    "likeCount": 0,
    "replyCount": 0,
    "createdAt": "2026-02-06T...",
    "updatedAt": "2026-02-06T...",
    "user": {
      "id": "uuid",
      "username": "username",
      "avatarUrl": "https://..."
    }
  }
}
```

### 3. æ›´æ–°è¯„è®º
```
PUT /api/comments/:id
```

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "content": "æ›´æ–°åçš„è¯„è®ºå†…å®¹"
}
```

### 4. åˆ é™¤è¯„è®º
```
DELETE /api/comments/:id
```

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "è¯„è®ºåˆ é™¤æˆåŠŸ",
  "data": null
}
```

---

## ğŸ¯ å®ç°ç»†èŠ‚

### åµŒå¥—å›å¤å¤„ç†
- é¡¶çº§è¯„è®ºï¼ˆparentIdä¸ºnullï¼‰æ˜¾ç¤ºåœ¨åˆ—è¡¨
- æ¯ä¸ªé¡¶çº§è¯„è®ºæœ€å¤šæ˜¾ç¤º10æ¡å›å¤
- å›å¤æŒ‰åˆ›å»ºæ—¶é—´å‡åºæ’åˆ—
- åˆ›å»ºå›å¤æ—¶è‡ªåŠ¨æ›´æ–°çˆ¶è¯„è®ºçš„replyCount

### æ•°æ®ç»Ÿè®¡
- åˆ›å»ºè¯„è®ºæ—¶è‡ªåŠ¨å¢åŠ å¸–å­commentCount
- åˆ é™¤è¯„è®ºæ—¶è‡ªåŠ¨å‡å°‘å¸–å­commentCount
- åˆ›å»ºå›å¤æ—¶è‡ªåŠ¨å¢åŠ çˆ¶è¯„è®ºreplyCount
- åˆ é™¤å›å¤æ—¶è‡ªåŠ¨å‡å°‘çˆ¶è¯„è®ºreplyCount

### æƒé™æ§åˆ¶
- åˆ›å»ºè¯„è®ºéœ€è¦ç™»å½•
- æ›´æ–°/åˆ é™¤è¯„è®ºåªèƒ½æ“ä½œè‡ªå·±çš„è¯„è®º
- æœªç™»å½•ç”¨æˆ·åªèƒ½æŸ¥çœ‹è¯„è®ºåˆ—è¡¨

### è½¯åˆ é™¤
- åˆ é™¤è¯„è®ºæ—¶è®¾ç½®isDeleted=true
- è®¾ç½®deletedAtæ—¶é—´æˆ³
- æŸ¥è¯¢æ—¶è¿‡æ»¤å·²åˆ é™¤çš„è¯„è®º

---

## ğŸ“Š APIç»Ÿè®¡

### å·²å®ç°æ¥å£ï¼ˆ8/39ï¼‰
- âœ… è®¤è¯æ¨¡å—ï¼ˆ4ä¸ªï¼‰
- âœ… å¸–å­æ¨¡å—ï¼ˆ5ä¸ªï¼‰
- âœ… åˆ†ç±»æ¨¡å—ï¼ˆ1ä¸ªï¼‰
- âœ… è¯„è®ºæ¨¡å—ï¼ˆ4ä¸ªï¼‰â† æ–°å¢

### å¾…å®ç°æ¥å£ï¼ˆ31ä¸ªï¼‰
- â­ï¸ ç”¨æˆ·æ¨¡å—ï¼ˆ2ä¸ªï¼‰
- â­ï¸ äº’åŠ¨æ¨¡å—ï¼ˆ4ä¸ªï¼‰
- â­ï¸ ç§ä¿¡æ¨¡å—ï¼ˆ5ä¸ªï¼‰
- â­ï¸ å­¦ä¹ èµ„æ–™æ¨¡å—ï¼ˆ3ä¸ªï¼‰
- â­ï¸ å…³æ³¨æ¨¡å—ï¼ˆ4ä¸ªï¼‰
- â­ï¸ é€šçŸ¥æ¨¡å—ï¼ˆ4ä¸ªï¼‰
- â­ï¸ æœç´¢æ¨¡å—ï¼ˆ1ä¸ªï¼‰
- â­ï¸ æ–‡ä»¶ä¸Šä¼ ï¼ˆ2ä¸ªï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ä¼˜å…ˆçº§1ï¼šå®ç°äº’åŠ¨æ¨¡å—API
- POST /api/posts/:id/like - ç‚¹èµå¸–å­
- DELETE /api/posts/:id/like - å–æ¶ˆç‚¹èµ
- POST /api/posts/:id/favorite - æ”¶è—å¸–å­
- DELETE /api/posts/:id/favorite - å–æ¶ˆæ”¶è—

### ä¼˜å…ˆçº§2ï¼šå®ç°ç”¨æˆ·æ¨¡å—API
- GET /api/users/:id - è·å–ç”¨æˆ·ä¿¡æ¯
- PUT /api/users/:id - æ›´æ–°ç”¨æˆ·ä¿¡æ¯

### ä¼˜å…ˆçº§3ï¼šå®ç°ç§ä¿¡æ¨¡å—APIï¼ˆP1åŠŸèƒ½ï¼‰
- GET /api/conversations - è·å–å¯¹è¯åˆ—è¡¨
- GET /api/conversations/:userId - è·å–å¯¹è¯è¯¦æƒ…
- POST /api/conversations/:userId/messages - å‘é€æ¶ˆæ¯
- PUT /api/messages/:id/read - æ ‡è®°å·²è¯»
- GET /api/messages/unread-count - è·å–æœªè¯»æ•°

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2026-02-06  
**çŠ¶æ€ï¼š** âœ… è¯„è®ºæ¨¡å—APIå®ç°å®Œæˆ
