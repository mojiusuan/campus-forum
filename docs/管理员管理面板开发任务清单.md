# 管理员管理面板开发任务清单

## 📋 任务总览

**总任务数：** 120+  
**预计时间：** 60-80小时  
**预计周期：** 4周

---

## 第1周：权限系统 + 基础框架（20小时）

### ✅ Day 1-2：数据库设计（4小时）

#### 任务1.1：修改User表
- [ ] 在 schema.prisma 中添加 `role` 字段
- [ ] 添加 `isAdmin` 字段（兼容性）
- [ ] 创建数据库迁移文件
- [ ] 运行迁移
- [ ] 验证字段添加成功

#### 任务1.2：创建AdminLog表
- [ ] 在 schema.prisma 中定义 AdminLog 模型
- [ ] 定义字段：id, adminId, action, targetType, targetId, description, ipAddress, userAgent, createdAt
- [ ] 定义与 User 的关系
- [ ] 添加索引
- [ ] 创建数据库迁移文件
- [ ] 运行迁移

#### 任务1.3：更新User关系
- [ ] 在 User 模型中添加 adminLogs 关系
- [ ] 运行迁移

#### 任务1.4：创建初始管理员
- [ ] 创建种子数据脚本
- [ ] 创建管理员账号（role: 'admin'）
- [ ] 运行种子脚本
- [ ] 验证管理员账号创建成功

**检查点：**
- [ ] 数据库迁移成功
- [ ] AdminLog 表创建成功
- [ ] 管理员账号创建成功

---

### ✅ Day 3-4：后端权限系统（8小时）

#### 任务2.1：更新JWT工具
- [ ] 修改 generateToken 函数，支持 role 参数
- [ ] 修改 verifyToken 返回类型，包含 role
- [ ] 更新类型定义

#### 任务2.2：创建管理员中间件
- [ ] 创建 `backend/src/middleware/adminAuth.ts`
- [ ] 实现 `requireAdmin` 中间件
  - [ ] 验证用户已登录
  - [ ] 验证用户是管理员（role === 'admin' || role === 'super_admin'）
  - [ ] 验证用户未被禁用
- [ ] 实现 `requireSuperAdmin` 中间件
- [ ] 添加错误处理

#### 任务2.3：更新认证路由
- [ ] 修改注册接口，默认 role 为 'user'
- [ ] 修改登录接口，返回用户 role
- [ ] 修改 GET /api/auth/me，返回用户 role

#### 任务2.4：创建操作日志工具
- [ ] 创建 `backend/src/utils/adminLog.ts`
- [ ] 实现 `logAdminAction` 函数
  - [ ] 记录操作类型
  - [ ] 记录目标类型和ID
  - [ ] 记录IP地址和User-Agent
  - [ ] 记录操作描述
- [ ] 创建操作类型常量

#### 任务2.5：更新Request类型
- [ ] 扩展 Express Request，添加 role 字段
- [ ] 更新中间件中的类型定义

**检查点：**
- [ ] 管理员中间件正常工作
- [ ] JWT Token 包含角色信息
- [ ] 操作日志工具可用

---

### ✅ Day 5：前端权限系统（4小时）

#### 任务3.1：更新authStore
- [ ] 在 User 类型中添加 role 字段
- [ ] 更新 login 方法，保存 role
- [ ] 更新 register 方法，保存 role
- [ ] 添加 `isAdmin` 计算属性
- [ ] 添加 `isSuperAdmin` 计算属性

#### 任务3.2：创建AdminRoute组件
- [ ] 创建 `frontend/src/components/AdminRoute.tsx`
- [ ] 检查用户是否是管理员
- [ ] 非管理员跳转到首页
- [ ] 显示加载状态

#### 任务3.3：创建useAdmin Hook
- [ ] 创建 `frontend/src/hooks/useAdmin.ts`
- [ ] 实现 `useIsAdmin` hook
- [ ] 实现 `useIsSuperAdmin` hook
- [ ] 实现 `useRequireAdmin` hook（需要管理员权限）

#### 任务3.4：更新ProtectedRoute
- [ ] 添加管理员权限检查选项
- [ ] 支持角色权限控制

**检查点：**
- [ ] 管理员可以访问管理页面
- [ ] 普通用户无法访问管理页面
- [ ] 权限检查正常工作

---

### ✅ Day 6-7：管理面板基础框架（4小时）

#### 任务4.1：创建AdminLayout组件
- [ ] 创建 `frontend/src/components/admin/AdminLayout.tsx`
- [ ] 实现侧边栏导航
  - [ ] 数据概览
  - [ ] 帖子管理
  - [ ] 评论管理
  - [ ] 用户管理
  - [ ] 分类管理
  - [ ] 学习资料
  - [ ] 数据统计
  - [ ] 操作日志
- [ ] 实现顶部栏
  - [ ] 显示当前管理员信息
  - [ ] 退出登录按钮
- [ ] 实现面包屑导航
- [ ] 响应式设计（移动端适配）

#### 任务4.2：创建管理员路由
- [ ] 在 App.tsx 中添加管理员路由
- [ ] 配置所有管理页面路由
- [ ] 使用 AdminRoute 保护路由
- [ ] 使用 AdminLayout 作为布局

#### 任务4.3：创建导航菜单数据
- [ ] 定义菜单项数据结构
- [ ] 实现菜单项高亮（当前路由）
- [ ] 实现菜单折叠/展开

#### 任务4.4：基础样式设置
- [ ] 创建管理员专用样式
- [ ] 设置主题色
- [ ] 设置字体和间距

**检查点：**
- [ ] AdminLayout 正常显示
- [ ] 导航菜单正常工作
- [ ] 路由跳转正常
- [ ] 响应式设计正常

---

## 第2周：内容管理 + 用户管理（20小时）

### ✅ Day 8-9：帖子管理后端（6小时）

#### 任务5.1：创建管理员帖子控制器
- [ ] 创建 `backend/src/controllers/admin.post.controller.ts`
- [ ] 实现 `getPosts` 函数
  - [ ] 支持查询已删除的帖子
  - [ ] 支持按状态筛选（all/deleted/pinned/locked）
  - [ ] 支持按分类、用户筛选
  - [ ] 支持关键词搜索
  - [ ] 支持分页
  - [ ] 返回完整帖子信息（包含用户、分类）

#### 任务5.2：实现帖子删除接口
- [ ] 实现 `deletePost` 函数（硬删除）
  - [ ] 验证权限
  - [ ] 删除帖子及相关数据（评论、点赞、收藏）
  - [ ] 记录操作日志
  - [ ] 更新分类统计

#### 任务5.3：实现帖子恢复接口
- [ ] 实现 `restorePost` 函数
  - [ ] 恢复软删除的帖子
  - [ ] 记录操作日志

#### 任务5.4：实现置顶接口
- [ ] 实现 `pinPost` 函数
- [ ] 实现 `unpinPost` 函数
- [ ] 记录操作日志

#### 任务5.5：实现锁定接口
- [ ] 实现 `lockPost` 函数
- [ ] 实现 `unlockPost` 函数
- [ ] 记录操作日志

#### 任务5.6：创建管理员帖子路由
- [ ] 创建 `backend/src/routes/admin.posts.routes.ts`
- [ ] 配置所有路由
- [ ] 添加权限中间件
- [ ] 在主路由中注册

**检查点：**
- [ ] 所有API接口正常工作
- [ ] 权限验证正常
- [ ] 操作日志记录正常

---

### ✅ Day 10：帖子管理前端（4小时）

#### 任务6.1：创建AdminPosts页面
- [ ] 创建 `frontend/src/pages/admin/AdminPosts.tsx`
- [ ] 实现帖子列表展示
  - [ ] 显示帖子标题、作者、分类、发布时间
  - [ ] 显示帖子状态（正常/已删除/置顶/锁定）
  - [ ] 显示统计数据（浏览量、点赞数、评论数）

#### 任务6.2：实现筛选和搜索
- [ ] 实现状态筛选（全部/正常/已删除/置顶/锁定）
- [ ] 实现分类筛选
- [ ] 实现用户筛选
- [ ] 实现关键词搜索
- [ ] 实现分页

#### 任务6.3：实现操作功能
- [ ] 实现删除功能（带确认对话框）
- [ ] 实现恢复功能
- [ ] 实现置顶/取消置顶
- [ ] 实现锁定/解锁
- [ ] 实现批量操作（批量删除、批量恢复）

#### 任务6.4：优化用户体验
- [ ] 添加加载状态
- [ ] 添加错误提示
- [ ] 操作成功后刷新列表
- [ ] 添加操作确认提示

**检查点：**
- [ ] 帖子列表正常显示
- [ ] 筛选和搜索正常工作
- [ ] 所有操作功能正常
- [ ] 用户体验良好

---

### ✅ Day 11：评论管理（4小时）

#### 任务7.1：评论管理后端
- [ ] 在 `admin.post.controller.ts` 中添加评论管理函数
- [ ] 实现 `getComments` 函数（管理员视图）
- [ ] 实现 `deleteComment` 函数（硬删除）
- [ ] 实现 `restoreComment` 函数
- [ ] 添加路由

#### 任务7.2：评论管理前端
- [ ] 创建 `frontend/src/pages/admin/AdminComments.tsx`
- [ ] 实现评论列表展示
- [ ] 实现筛选和搜索
- [ ] 实现删除和恢复功能
- [ ] 实现批量操作

**检查点：**
- [ ] 评论管理功能正常
- [ ] 操作日志记录正常

---

### ✅ Day 12-13：用户管理后端（6小时）

#### 任务8.1：创建管理员用户控制器
- [ ] 创建 `backend/src/controllers/admin.user.controller.ts`
- [ ] 实现 `getUsers` 函数
  - [ ] 支持搜索（用户名、邮箱）
  - [ ] 支持按角色筛选
  - [ ] 支持按状态筛选（全部/活跃/封禁）
  - [ ] 支持分页
  - [ ] 返回用户统计信息（发帖数、评论数）

#### 任务8.2：实现用户详情接口
- [ ] 实现 `getUserById` 函数
  - [ ] 返回完整用户信息
  - [ ] 返回用户发帖列表（最近10条）
  - [ ] 返回用户评论列表（最近10条）
  - [ ] 返回用户违规记录

#### 任务8.3：实现用户封禁接口
- [ ] 实现 `banUser` 函数
  - [ ] 设置用户 isActive 为 false
  - [ ] 记录封禁原因
  - [ ] 记录操作日志
  - [ ] 可选：设置封禁时长

#### 任务8.4：实现用户解封接口
- [ ] 实现 `unbanUser` 函数
  - [ ] 设置用户 isActive 为 true
  - [ ] 记录操作日志

#### 任务8.5：实现用户修改接口
- [ ] 实现 `updateUser` 函数
  - [ ] 支持修改用户名、邮箱、角色
  - [ ] 支持修改 isActive 状态
  - [ ] 验证权限（普通管理员不能修改超级管理员）
  - [ ] 记录操作日志

#### 任务8.6：实现重置密码接口
- [ ] 实现 `resetPassword` 函数
  - [ ] 生成新密码（或使用指定密码）
  - [ ] 加密密码
  - [ ] 更新用户密码
  - [ ] 记录操作日志

#### 任务8.7：创建管理员用户路由
- [ ] 创建 `backend/src/routes/admin.users.routes.ts`
- [ ] 配置所有路由
- [ ] 添加权限中间件

**检查点：**
- [ ] 所有用户管理API正常
- [ ] 权限验证正常
- [ ] 操作日志记录正常

---

## 第3周：用户管理前端 + 分类管理 + 数据统计（20小时）

### ✅ Day 14-15：用户管理前端（6小时）

#### 任务9.1：创建AdminUsers页面
- [ ] 创建 `frontend/src/pages/admin/AdminUsers.tsx`
- [ ] 实现用户列表展示
  - [ ] 显示用户头像、用户名、邮箱
  - [ ] 显示用户角色
  - [ ] 显示用户状态（活跃/封禁）
  - [ ] 显示统计数据（发帖数、评论数）
  - [ ] 显示注册时间、最后登录时间

#### 任务9.2：实现搜索和筛选
- [ ] 实现关键词搜索（用户名、邮箱）
- [ ] 实现角色筛选
- [ ] 实现状态筛选
- [ ] 实现分页

#### 任务9.3：创建用户详情页面
- [ ] 创建 `frontend/src/pages/admin/AdminUserDetail.tsx`
- [ ] 显示用户基本信息
- [ ] 显示用户发帖列表
- [ ] 显示用户评论列表
- [ ] 显示用户违规记录

#### 任务9.4：实现用户操作功能
- [ ] 实现封禁功能（带原因输入）
- [ ] 实现解封功能
- [ ] 实现修改用户信息功能
- [ ] 实现重置密码功能
- [ ] 实现删除用户功能（软删除）

**检查点：**
- [ ] 用户管理功能完整
- [ ] 用户体验良好

---

### ✅ Day 16：学习资料管理（3小时）

#### 任务10.1：学习资料管理后端
- [ ] 在管理员控制器中添加资源管理函数
- [ ] 实现 GET /api/admin/resources
- [ ] 实现 DELETE /api/admin/resources/:id
- [ ] 添加路由

#### 任务10.2：学习资料管理前端
- [ ] 创建 `frontend/src/pages/admin/AdminResources.tsx`
- [ ] 实现资料列表展示
- [ ] 实现删除功能

**检查点：**
- [ ] 学习资料管理功能正常

---

### ✅ Day 17-18：分类管理（6小时）

#### 任务11.1：分类管理后端
- [ ] 创建 `backend/src/controllers/admin.category.controller.ts`
- [ ] 实现 `createCategory` 函数
  - [ ] 验证必填字段
  - [ ] 检查 slug 唯一性
  - [ ] 创建分类
  - [ ] 记录操作日志
- [ ] 实现 `updateCategory` 函数
- [ ] 实现 `deleteCategory` 函数
  - [ ] 检查是否有帖子使用该分类
  - [ ] 如果有帖子，不允许删除
- [ ] 实现 `reorderCategories` 函数
  - [ ] 批量更新分类顺序

#### 任务11.2：分类管理前端
- [ ] 创建 `frontend/src/pages/admin/AdminCategories.tsx`
- [ ] 实现分类列表展示
- [ ] 实现创建分类表单
- [ ] 实现编辑分类功能
- [ ] 实现删除分类功能（带确认）
- [ ] 实现分类排序（拖拽排序）
- [ ] 实现启用/禁用分类

**检查点：**
- [ ] 分类管理功能完整
- [ ] 拖拽排序正常工作

---

### ✅ Day 19-20：数据统计后端（5小时）

#### 任务12.1：创建统计控制器
- [ ] 创建 `backend/src/controllers/admin.stats.controller.ts`
- [ ] 实现 `getOverview` 函数
  - [ ] 用户总数、活跃用户数（30天内登录）
  - [ ] 帖子总数、今日新增
  - [ ] 评论总数、今日新增
  - [ ] 分类数量
- [ ] 实现 `getUserStats` 函数
  - [ ] 用户增长趋势（按天统计，7天/30天）
  - [ ] 活跃用户趋势
- [ ] 实现 `getPostStats` 函数
  - [ ] 帖子发布趋势（按天统计）
  - [ ] 帖子分类分布
- [ ] 实现 `getCategoryStats` 函数
  - [ ] 各分类的帖子数量
  - [ ] 各分类的评论数量

#### 任务12.2：优化查询性能
- [ ] 使用聚合查询
- [ ] 添加数据库索引（如需要）
- [ ] 考虑缓存（可选）

#### 任务12.3：创建统计路由
- [ ] 创建 `backend/src/routes/admin.stats.routes.ts`
- [ ] 配置所有路由
- [ ] 添加权限中间件

**检查点：**
- [ ] 统计数据准确
- [ ] 查询性能良好

---

## 第4周：数据统计前端 + 操作日志 + 测试优化（20小时）

### ✅ Day 21-23：数据统计前端（8小时）

#### 任务13.1：安装图表库
- [ ] 安装 Chart.js 或 Recharts
- [ ] 安装相关依赖

#### 任务13.2：创建AdminDashboard页面
- [ ] 创建 `frontend/src/pages/admin/AdminDashboard.tsx`
- [ ] 实现概览统计卡片
  - [ ] 用户总数卡片
  - [ ] 帖子总数卡片
  - [ ] 评论总数卡片
  - [ ] 今日新增卡片
- [ ] 实现数据刷新功能

#### 任务13.3：实现趋势图表
- [ ] 实现用户增长趋势图（折线图）
- [ ] 实现帖子发布趋势图（折线图）
- [ ] 实现活跃度趋势图（折线图）
- [ ] 实现时间范围选择（7天/30天/全部）

#### 任务13.4：实现分布图表
- [ ] 实现分类分布饼图
- [ ] 实现用户角色分布饼图
- [ ] 实现帖子状态分布柱状图

#### 任务13.5：实现数据导出
- [ ] 实现导出为CSV功能
- [ ] 实现导出为Excel功能（可选）
- [ ] 添加导出按钮

**检查点：**
- [ ] 图表正常显示
- [ ] 数据准确
- [ ] 导出功能正常

---

### ✅ Day 24：操作日志（4小时）

#### 任务14.1：操作日志后端
- [ ] 在管理员控制器中添加日志查询函数
- [ ] 实现 `getLogs` 函数
  - [ ] 支持按管理员筛选
  - [ ] 支持按操作类型筛选
  - [ ] 支持按时间范围筛选
  - [ ] 支持分页
- [ ] 实现 `getLogById` 函数
- [ ] 添加路由

#### 任务14.2：操作日志前端
- [ ] 创建 `frontend/src/pages/admin/AdminLogs.tsx`
- [ ] 实现日志列表展示
- [ ] 实现筛选功能
- [ ] 实现日志详情查看
- [ ] 实现日志导出功能

**检查点：**
- [ ] 日志记录完整
- [ ] 日志查询正常

---

### ✅ Day 25-26：系统设置（可选，4小时）

#### 任务15.1：系统设置后端
- [ ] 创建系统设置表（可选，或使用配置文件）
- [ ] 实现 GET /api/admin/settings
- [ ] 实现 PUT /api/admin/settings
- [ ] 添加路由

#### 任务15.2：系统设置前端
- [ ] 创建 `frontend/src/pages/admin/AdminSettings.tsx`
- [ ] 实现站点设置表单
- [ ] 实现功能开关
- [ ] 实现文件上传限制设置

**检查点：**
- [ ] 系统设置功能正常

---

### ✅ Day 27-28：测试和优化（4小时）

#### 任务16.1：功能测试
- [ ] 测试所有管理功能
- [ ] 测试权限控制
- [ ] 测试边界情况
- [ ] 记录Bug

#### 任务16.2：权限测试
- [ ] 测试普通用户无法访问管理页面
- [ ] 测试管理员权限正常
- [ ] 测试超级管理员权限
- [ ] 测试操作日志记录

#### 任务16.3：性能优化
- [ ] 优化查询性能
- [ ] 优化前端渲染性能
- [ ] 添加加载状态
- [ ] 添加错误处理

#### 任务16.4：UI/UX优化
- [ ] 优化界面布局
- [ ] 优化交互体验
- [ ] 添加操作提示
- [ ] 优化移动端显示

#### 任务16.5：Bug修复
- [ ] 修复发现的所有Bug
- [ ] 验证修复效果

**检查点：**
- [ ] 所有功能正常
- [ ] 性能良好
- [ ] 用户体验良好
- [ ] 无严重Bug

---

## 📊 进度跟踪

### 第1周进度
- [ ] Day 1-2：数据库设计
- [ ] Day 3-4：后端权限系统
- [ ] Day 5：前端权限系统
- [ ] Day 6-7：管理面板基础框架

### 第2周进度
- [ ] Day 8-9：帖子管理后端
- [ ] Day 10：帖子管理前端
- [ ] Day 11：评论管理
- [ ] Day 12-13：用户管理后端

### 第3周进度
- [ ] Day 14-15：用户管理前端
- [ ] Day 16：学习资料管理
- [ ] Day 17-18：分类管理
- [ ] Day 19-20：数据统计后端

### 第4周进度
- [ ] Day 21-23：数据统计前端
- [ ] Day 24：操作日志
- [ ] Day 25-26：系统设置（可选）
- [ ] Day 27-28：测试和优化

---

## 🎯 完成标准

### 功能完整性
- [ ] 所有计划的功能都已实现
- [ ] 所有API接口正常工作
- [ ] 所有前端页面正常工作

### 代码质量
- [ ] 代码符合规范
- [ ] 有适当的注释
- [ ] 错误处理完善

### 测试
- [ ] 功能测试通过
- [ ] 权限测试通过
- [ ] 性能测试通过

### 文档
- [ ] API文档完整
- [ ] 使用说明完整

---

**文档版本：** v1.0  
**创建日期：** 2026-02-09
