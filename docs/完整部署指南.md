# æ ¡å›­è®ºå›é¡¹ç›® - å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [éƒ¨ç½²å‰å‡†å¤‡](#éƒ¨ç½²å‰å‡†å¤‡)
2. [æœåŠ¡å™¨ç¯å¢ƒé…ç½®](#æœåŠ¡å™¨ç¯å¢ƒé…ç½®)
3. [æ•°æ®åº“é…ç½®](#æ•°æ®åº“é…ç½®)
4. [åç«¯éƒ¨ç½²](#åç«¯éƒ¨ç½²)
5. [å‰ç«¯éƒ¨ç½²](#å‰ç«¯éƒ¨ç½²)
6. [Nginxé…ç½®](#nginxé…ç½®)
7. [SSLè¯ä¹¦é…ç½®](#sslè¯ä¹¦é…ç½®)
8. [è¿›ç¨‹ç®¡ç†ï¼ˆPM2ï¼‰](#è¿›ç¨‹ç®¡ç†pm2)
9. [ç›‘æ§å’Œæ—¥å¿—](#ç›‘æ§å’Œæ—¥å¿—)
10. [å¤‡ä»½ç­–ç•¥](#å¤‡ä»½ç­–ç•¥)
11. [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸš€ éƒ¨ç½²å‰å‡†å¤‡

### 1. æ£€æŸ¥æ¸…å•

åœ¨å¼€å§‹éƒ¨ç½²å‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•å®Œæˆ
- [ ] ä»£ç å·²æäº¤åˆ°Gitä»“åº“
- [ ] ç”Ÿäº§ç¯å¢ƒå˜é‡å·²å‡†å¤‡å¥½
- [ ] æœåŠ¡å™¨å·²è´­ä¹°å¹¶é…ç½®å¥½
- [ ] åŸŸåå·²è´­ä¹°å¹¶è§£æ
- [ ] æ•°æ®åº“å¯†ç å·²ä¿®æ”¹ä¸ºå¼ºå¯†ç 
- [ ] JWTå¯†é’¥å·²ç”Ÿæˆï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰
- [ ] ç®¡ç†å‘˜è´¦å·å¯†ç å·²ä¿®æ”¹

### 2. ç”Ÿæˆå®‰å…¨å¯†é’¥

```bash
# ç”ŸæˆJWTå¯†é’¥ï¼ˆ32å­—èŠ‚ï¼‰
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# ç”Ÿæˆæ•°æ®åº“å¯†ç ï¼ˆå¯é€‰ï¼‰
openssl rand -base64 24
```

### 3. å‡†å¤‡éƒ¨ç½²æ–‡ä»¶

ç¡®ä¿ä»¥ä¸‹æ–‡ä»¶å·²å‡†å¤‡å¥½ï¼š
- `backend/.env` - ç”Ÿäº§ç¯å¢ƒå˜é‡
- `frontend/.env.production` - å‰ç«¯ç”Ÿäº§ç¯å¢ƒå˜é‡
- æ•°æ®åº“å¤‡ä»½ï¼ˆå¦‚æœæœ‰ï¼‰

---

## ğŸ–¥ï¸ æœåŠ¡å™¨ç¯å¢ƒé…ç½®

### 1. è¿æ¥æœåŠ¡å™¨

```bash
ssh root@your-server-ip
```

### 2. æ›´æ–°ç³»ç»Ÿ

```bash
sudo apt update
sudo apt upgrade -y
```

### 3. å®‰è£…Node.js 20

```bash
# ä½¿ç”¨NodeSourceå®‰è£…Node.js 20
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# éªŒè¯å®‰è£…
node --version  # åº”è¯¥æ˜¾ç¤º v20.x.x
npm --version
```

### 4. å®‰è£…PostgreSQL

```bash
# å®‰è£…PostgreSQL
sudo apt install -y postgresql postgresql-contrib

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start postgresql
sudo systemctl enable postgresql

# éªŒè¯å®‰è£…
sudo systemctl status postgresql
```

### 5. å®‰è£…Nginx

```bash
# å®‰è£…Nginx
sudo apt install -y nginx

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start nginx
sudo systemctl enable nginx

# éªŒè¯å®‰è£…
sudo systemctl status nginx
```

### 6. å®‰è£…PM2

```bash
# å…¨å±€å®‰è£…PM2
sudo npm install -g pm2

# è®¾ç½®PM2å¼€æœºè‡ªå¯
pm2 startup
# æŒ‰ç…§æç¤ºæ‰§è¡Œè¾“å‡ºçš„å‘½ä»¤ï¼ˆé€šå¸¸æ˜¯sudo env PATH=...ï¼‰

# éªŒè¯å®‰è£…
pm2 --version
```

### 7. åˆ›å»ºåº”ç”¨ç›®å½•

```bash
# åˆ›å»ºåº”ç”¨ç›®å½•
sudo mkdir -p /var/www/forum
sudo chown -R $USER:$USER /var/www/forum

# åˆ›å»ºæ—¥å¿—ç›®å½•
sudo mkdir -p /var/log/forum
sudo chown -R $USER:$USER /var/log/forum

# åˆ›å»ºä¸Šä¼ æ–‡ä»¶ç›®å½•
sudo mkdir -p /var/www/forum/uploads
sudo chown -R $USER:$USER /var/www/forum/uploads
```

---

## ğŸ—„ï¸ æ•°æ®åº“é…ç½®

### 1. åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·

```bash
# åˆ‡æ¢åˆ°postgresç”¨æˆ·
sudo -u postgres psql

# åœ¨PostgreSQLå‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼š
```

```sql
-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE forum;

-- åˆ›å»ºç”¨æˆ·ï¼ˆè¯·æ›¿æ¢ä¸ºå¼ºå¯†ç ï¼‰
CREATE USER forum_user WITH PASSWORD 'your_strong_password_here';

-- æˆæƒ
GRANT ALL PRIVILEGES ON DATABASE forum TO forum_user;

-- å…è®¸ç”¨æˆ·åˆ›å»ºæ•°æ®åº“ï¼ˆç”¨äºè¿ç§»ï¼‰
ALTER USER forum_user CREATEDB;

-- é€€å‡º
\q
```

### 2. é…ç½®PostgreSQLè¿œç¨‹è®¿é—®ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦ä»å¤–éƒ¨è®¿é—®æ•°æ®åº“ï¼š

```bash
# ç¼–è¾‘PostgreSQLé…ç½®
sudo nano /etc/postgresql/14/main/postgresql.conf

# æ‰¾åˆ°å¹¶ä¿®æ”¹ï¼š
# listen_addresses = 'localhost' æ”¹ä¸º
listen_addresses = '*'

# ç¼–è¾‘è®¿é—®æ§åˆ¶
sudo nano /etc/postgresql/14/main/pg_hba.conf

# æ·»åŠ ï¼š
host    all             all             0.0.0.0/0               md5

# é‡å¯PostgreSQL
sudo systemctl restart postgresql
```

### 3. é…ç½®é˜²ç«å¢™

```bash
# å…è®¸PostgreSQLç«¯å£ï¼ˆä»…å†…ç½‘è®¿é—®ï¼Œä¸å¯¹å¤–å¼€æ”¾ï¼‰
sudo ufw allow from 127.0.0.1 to any port 5432
```

---

## ğŸ”§ åç«¯éƒ¨ç½²

### 1. å…‹éš†é¡¹ç›®

```bash
cd /var/www/forum
git clone https://github.com/your-username/forum.git .

# æˆ–ä½¿ç”¨SSH
git clone git@github.com:your-username/forum.git .
```

### 2. å®‰è£…ä¾èµ–

```bash
cd backend
npm install --production
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env
```

**ç”Ÿäº§ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ.envï¼‰ï¼š**

```env
# ç¯å¢ƒ
NODE_ENV=production
PORT=3000

# æ•°æ®åº“ï¼ˆä½¿ç”¨å¼ºå¯†ç ï¼‰
DATABASE_URL=postgresql://forum_user:your_strong_password@localhost:5432/forum?schema=public

# JWTå¯†é’¥ï¼ˆä½¿ç”¨ç”Ÿæˆçš„å¼ºå¯†é’¥ï¼‰
JWT_SECRET=your_generated_jwt_secret_key_min_32_chars

# CORSï¼ˆå‰ç«¯åŸŸåï¼‰
CORS_ORIGIN=https://yourdomain.com

# æ–‡ä»¶ä¸Šä¼ ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰
UPLOAD_DIR=/var/www/forum/uploads
MAX_FILE_SIZE=10485760

# å¯é€‰ï¼šOSSé…ç½®ï¼ˆå¦‚æœä½¿ç”¨äº‘å­˜å‚¨ï¼‰
# OSS_ACCESS_KEY_ID=your_key
# OSS_ACCESS_KEY_SECRET=your_secret
# OSS_BUCKET=your_bucket
# OSS_REGION=your_region
```

### 4. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
# ç”ŸæˆPrisma Client
npm run prisma:generate

# è¿è¡Œè¿ç§»
npx prisma migrate deploy

# è¿è¡Œç§å­æ•°æ®ï¼ˆåˆ›å»ºç®¡ç†å‘˜è´¦å·ï¼‰
npm run prisma:seed

# æˆ–å•ç‹¬è¿è¡Œç®¡ç†å‘˜ç§å­è„šæœ¬
npx tsx prisma/seed-admin.ts
```

### 5. æ„å»ºé¡¹ç›®

```bash
# æ„å»ºTypeScript
npm run build

# éªŒè¯æ„å»º
ls -la dist/
```

### 6. æµ‹è¯•è¿è¡Œ

```bash
# ä½¿ç”¨PM2æµ‹è¯•è¿è¡Œ
pm2 start dist/app.js --name forum-api-test

# æ£€æŸ¥æ—¥å¿—
pm2 logs forum-api-test

# å¦‚æœæ­£å¸¸ï¼Œåœæ­¢æµ‹è¯•å®ä¾‹
pm2 delete forum-api-test
```

### 7. æ­£å¼å¯åŠ¨

```bash
# ä½¿ç”¨PM2å¯åŠ¨
pm2 start dist/app.js --name forum-api --env production

# ä¿å­˜PM2é…ç½®
pm2 save

# æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs forum-api
```

---

## ğŸ¨ å‰ç«¯éƒ¨ç½²

### æ–¹æ¡ˆ1ï¼šä½¿ç”¨Nginxç›´æ¥éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### 1. æ„å»ºå‰ç«¯

```bash
cd /var/www/forum/frontend

# å®‰è£…ä¾èµ–
npm install

# é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
cp .env.local.example .env.production
nano .env.production
```

**å‰ç«¯ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆ.env.productionï¼‰ï¼š**

```env
VITE_API_URL=https://api.yourdomain.com
```

#### 2. æ„å»ºé¡¹ç›®

```bash
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# æ„å»ºäº§ç‰©åœ¨ dist/ ç›®å½•
ls -la dist/
```

#### 3. é…ç½®Nginxï¼ˆè§ä¸‹æ–¹Nginxé…ç½®ï¼‰

---

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨OSS + CDNéƒ¨ç½²

#### 1. æ„å»ºå‰ç«¯

```bash
cd /var/www/forum/frontend
npm install
npm run build
```

#### 2. ä¸Šä¼ åˆ°OSS

```bash
# å®‰è£…ossutilï¼ˆé˜¿é‡Œäº‘OSSå·¥å…·ï¼‰
# ä¸‹è½½åœ°å€ï¼šhttps://help.aliyun.com/document_detail/120075.html

# é…ç½®ossutil
ossutil config

# ä¸Šä¼ æ–‡ä»¶
ossutil cp -r dist/ oss://your-bucket-name/ --update

# è®¾ç½®é™æ€ç½‘ç«™æ‰˜ç®¡
ossutil bucket-website --method put oss://your-bucket-name/ --index-document index.html --error-document index.html
```

#### 3. é…ç½®CDN

1. åœ¨é˜¿é‡Œäº‘CDNæ§åˆ¶å°åˆ›å»ºåŠ é€ŸåŸŸå
2. æºç«™è®¾ç½®ä¸ºOSS Bucket
3. é…ç½®HTTPSè¯ä¹¦
4. é…ç½®ç¼“å­˜è§„åˆ™

---

## ğŸŒ Nginxé…ç½®

### 1. åç«¯APIé…ç½®

```bash
sudo nano /etc/nginx/sites-available/forum-api
```

**é…ç½®å†…å®¹ï¼š**

```nginx
server {
    listen 80;
    server_name api.yourdomain.com;

    # æ—¥å¿—
    access_log /var/log/nginx/forum-api-access.log;
    error_log /var/log/nginx/forum-api-error.log;

    # æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    client_max_body_size 10M;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€æ–‡ä»¶ï¼ˆä¸Šä¼ çš„æ–‡ä»¶ï¼‰
    location /uploads {
        alias /var/www/forum/uploads;
        expires 30d;
        add_header Cache-Control "public, immutable";
    }
}
```

### 2. å‰ç«¯é…ç½®ï¼ˆå¦‚æœä½¿ç”¨Nginxï¼‰

```bash
sudo nano /etc/nginx/sites-available/forum-frontend
```

**é…ç½®å†…å®¹ï¼š**

```nginx
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;

    root /var/www/forum/frontend/dist;
    index index.html;

    # æ—¥å¿—
    access_log /var/log/nginx/forum-frontend-access.log;
    error_log /var/log/nginx/forum-frontend-error.log;

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json;

    # SPAè·¯ç”±æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### 3. å¯ç”¨é…ç½®

```bash
# åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -s /etc/nginx/sites-available/forum-api /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/forum-frontend /etc/nginx/sites-enabled/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½Nginx
sudo systemctl reload nginx
```

---

## ğŸ”’ SSLè¯ä¹¦é…ç½®

### ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦

```bash
# å®‰è£…Certbot
sudo apt install certbot python3-certbot-nginx

# è·å–è¯ä¹¦ï¼ˆæ›¿æ¢ä¸ºä½ çš„åŸŸåï¼‰
sudo certbot --nginx -d api.yourdomain.com -d yourdomain.com -d www.yourdomain.com

# æŒ‰ç…§æç¤ºæ“ä½œï¼š
# 1. è¾“å…¥é‚®ç®±
# 2. åŒæ„æœåŠ¡æ¡æ¬¾
# 3. é€‰æ‹©æ˜¯å¦åˆ†äº«é‚®ç®±
# 4. é€‰æ‹©æ˜¯å¦é‡å®šå‘HTTPåˆ°HTTPSï¼ˆæ¨èé€‰æ‹©2ï¼‰

# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# è¯ä¹¦ä¼šè‡ªåŠ¨ç»­æœŸï¼ˆå·²é…ç½®cronä»»åŠ¡ï¼‰
```

### éªŒè¯HTTPS

è®¿é—®ä»¥ä¸‹URLéªŒè¯ï¼š
- `https://api.yourdomain.com/api/health`
- `https://yourdomain.com`

---

## ğŸ“¦ è¿›ç¨‹ç®¡ç†ï¼ˆPM2ï¼‰

### PM2å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 list

# æŸ¥çœ‹æ—¥å¿—
pm2 logs forum-api

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show forum-api

# é‡å¯åº”ç”¨
pm2 restart forum-api

# åœæ­¢åº”ç”¨
pm2 stop forum-api

# åˆ é™¤åº”ç”¨
pm2 delete forum-api

# ç›‘æ§é¢æ¿
pm2 monit

# ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
pm2 save

# æŸ¥çœ‹å¯åŠ¨è„šæœ¬
pm2 startup
```

### PM2é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

åˆ›å»º `backend/ecosystem.config.js`ï¼š

```javascript
module.exports = {
  apps: [{
    name: 'forum-api',
    script: './dist/app.js',
    instances: 1,
    exec_mode: 'fork',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: '/var/log/forum/error.log',
    out_file: '/var/log/forum/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    autorestart: true,
    max_memory_restart: '500M',
    watch: false
  }]
};
```

ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨ï¼š

```bash
pm2 start ecosystem.config.js
pm2 save
```

---

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨æ—¥å¿—

```bash
# PM2æ—¥å¿—ä½ç½®
~/.pm2/logs/

# Nginxæ—¥å¿—ä½ç½®
/var/log/nginx/

# åº”ç”¨æ—¥å¿—ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
/var/log/forum/
```

### 2. ç³»ç»Ÿç›‘æ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep node
```

### 3. æ•°æ®åº“ç›‘æ§

```bash
# è¿æ¥æ•°æ®åº“
sudo -u postgres psql

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
SELECT pg_database.datname, pg_size_pretty(pg_database_size(pg_database.datname)) AS size 
FROM pg_database 
ORDER BY pg_database_size(pg_database.datname) DESC;

# æŸ¥çœ‹è¿æ¥æ•°
SELECT count(*) FROM pg_stat_activity;
```

---

## ğŸ’¾ å¤‡ä»½ç­–ç•¥

### 1. æ•°æ®åº“å¤‡ä»½è„šæœ¬

åˆ›å»º `/var/www/forum/scripts/backup-db.sh`ï¼š

```bash
#!/bin/bash

# é…ç½®
DB_NAME="forum"
DB_USER="forum_user"
BACKUP_DIR="/var/backups/forum"
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/forum_$DATE.sql"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
PGPASSWORD=your_password pg_dump -U $DB_USER -h localhost $DB_NAME > $BACKUP_FILE

# å‹ç¼©å¤‡ä»½
gzip $BACKUP_FILE

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.sql.gz" -mtime +7 -delete

echo "Backup completed: $BACKUP_FILE.gz"
```

### 2. è®¾ç½®å®šæ—¶ä»»åŠ¡

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
0 2 * * * /var/www/forum/scripts/backup-db.sh >> /var/log/forum/backup.log 2>&1

# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x /var/www/forum/scripts/backup-db.sh
```

### 3. æ–‡ä»¶å¤‡ä»½

```bash
# å¤‡ä»½ä¸Šä¼ çš„æ–‡ä»¶
tar -czf /var/backups/forum/uploads_$(date +%Y%m%d).tar.gz /var/www/forum/uploads

# æ·»åŠ åˆ°crontabï¼ˆæ¯å‘¨å¤‡ä»½ä¸€æ¬¡ï¼‰
0 3 * * 0 tar -czf /var/backups/forum/uploads_$(date +\%Y\%m\%d).tar.gz /var/www/forum/uploads
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### 1. åº”ç”¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹PM2æ—¥å¿—
pm2 logs forum-api --lines 100

# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
sudo lsof -i :3000

# æ£€æŸ¥ç¯å¢ƒå˜é‡
pm2 show forum-api
```

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
psql -U forum_user -d forum -h localhost

# æ£€æŸ¥PostgreSQLçŠ¶æ€
sudo systemctl status postgresql

# æŸ¥çœ‹PostgreSQLæ—¥å¿—
sudo tail -f /var/log/postgresql/postgresql-14-main.log
```

### 3. Nginx 502é”™è¯¯

```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
pm2 status

# æ£€æŸ¥Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/forum-api-error.log

# æµ‹è¯•åç«¯API
curl http://localhost:3000/api/health
```

### 4. å‰ç«¯æ— æ³•è®¿é—®API

```bash
# æ£€æŸ¥CORSé…ç½®
# ç¡®ä¿åç«¯ .env ä¸­çš„ CORS_ORIGIN åŒ…å«å‰ç«¯åŸŸå

# æ£€æŸ¥API URL
# ç¡®ä¿å‰ç«¯ .env.production ä¸­çš„ VITE_API_URL æ­£ç¡®
```

### 5. æ–‡ä»¶ä¸Šä¼ å¤±è´¥

```bash
# æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
ls -la /var/www/forum/uploads

# è®¾ç½®æ­£ç¡®æƒé™
sudo chown -R $USER:$USER /var/www/forum/uploads
chmod -R 755 /var/www/forum/uploads

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

---

## âœ… éƒ¨ç½²åæ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·æ£€æŸ¥ï¼š

- [ ] åç«¯APIå¥åº·æ£€æŸ¥ï¼š`https://api.yourdomain.com/api/health`
- [ ] å‰ç«¯é¡µé¢æ­£å¸¸è®¿é—®ï¼š`https://yourdomain.com`
- [ ] ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] å‘å¸–åŠŸèƒ½æ­£å¸¸
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] ç®¡ç†å‘˜é¢æ¿å¯ä»¥è®¿é—®
- [ ] HTTPSè¯ä¹¦æ­£å¸¸
- [ ] PM2è¿›ç¨‹æ­£å¸¸è¿è¡Œ
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ—¥å¿—æ­£å¸¸è®°å½•
- [ ] å¤‡ä»½è„šæœ¬æ­£å¸¸æ‰§è¡Œ

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²æµç¨‹

å½“éœ€è¦æ›´æ–°ä»£ç æ—¶ï¼š

```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
cd /var/www/forum
git pull origin main

# 2. æ›´æ–°åç«¯
cd backend
npm install --production
npm run prisma:generate
npx prisma migrate deploy
npm run build
pm2 restart forum-api

# 3. æ›´æ–°å‰ç«¯
cd ../frontend
npm install
npm run build
# å¦‚æœä½¿ç”¨Nginxï¼Œæ–‡ä»¶å·²åœ¨distç›®å½•
# å¦‚æœä½¿ç”¨OSSï¼Œéœ€è¦é‡æ–°ä¸Šä¼ 
```

---

## ğŸš€ é«˜å¹¶å‘ä¼˜åŒ–ï¼ˆæ”¯æŒ10ä¸‡ç”¨æˆ·ï¼‰

### å½“å‰æ–¹æ¡ˆæ‰¿è½½èƒ½åŠ›

**å½“å‰é…ç½®ï¼ˆ2æ ¸4Gï¼Œ1Mbpsï¼‰ï¼š**
- âŒ **æ— æ³•**æ”¯æŒ10ä¸‡ç”¨æˆ·
- âœ… é€‚åˆMVPé˜¶æ®µï¼ˆ<5000ç”¨æˆ·ï¼‰
- æ‰¿è½½èƒ½åŠ›ï¼š500-1000å¹¶å‘ç”¨æˆ·

**è¯¦ç»†åˆ†æè¯·å‚è€ƒï¼š** `docs/é«˜å¹¶å‘æ¶æ„ä¼˜åŒ–æ–¹æ¡ˆ.md`

### å¿«é€Ÿä¼˜åŒ–æªæ–½ï¼ˆæå‡åˆ°5000-10000ç”¨æˆ·ï¼‰

#### 1. ä¼˜åŒ–æ•°æ®åº“è¿æ¥æ± 

å·²åœ¨ `backend/src/utils/db.ts` ä¸­é…ç½®ï¼Œå¯é€šè¿‡ç¯å¢ƒå˜é‡è°ƒæ•´ï¼š

```env
DB_POOL_MAX=50
DB_POOL_MIN=10
```

#### 2. PM2é›†ç¾¤æ¨¡å¼

åˆ›å»º `backend/ecosystem.config.js`ï¼š

```javascript
module.exports = {
  apps: [{
    name: 'forum-api',
    script: './dist/app.js',
    instances: 'max',  // ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    max_memory_restart: '500M',
    error_file: '/var/log/forum/error.log',
    out_file: '/var/log/forum/out.log',
  }]
};
```

å¯åŠ¨ï¼š
```bash
pm2 start ecosystem.config.js
pm2 save
```

#### 3. æ·»åŠ Redisç¼“å­˜ï¼ˆæ¨èï¼‰

```bash
# å®‰è£…Redis
sudo apt install redis-server
sudo systemctl start redis
sudo systemctl enable redis

# åç«¯å®‰è£…Rediså®¢æˆ·ç«¯
cd backend
npm install ioredis
```

#### 4. æœåŠ¡å™¨å‡çº§å»ºè®®

**æ”¯æŒ5000-10000ç”¨æˆ·ï¼š**
- å‡çº§åˆ°ï¼š8æ ¸16Gï¼Œ10Mbps
- æˆæœ¬ï¼šÂ¥300-500/æœˆ

**æ”¯æŒ10ä¸‡ç”¨æˆ·ï¼š**
- éœ€è¦åˆ†å¸ƒå¼æ¶æ„
- æˆæœ¬ï¼šÂ¥1,500-2,500/æœˆ
- è¯¦è§ï¼š`docs/é«˜å¹¶å‘æ¶æ„ä¼˜åŒ–æ–¹æ¡ˆ.md`

---

## ğŸ“ æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶
2. æ£€æŸ¥é…ç½®æ–‡ä»¶
3. å‚è€ƒæ•…éšœæ’æŸ¥ç« èŠ‚
4. æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2026-02-05
