# 部署检查清单

## 📋 部署前准备

### 代码准备
- [ ] 所有功能测试完成
- [ ] 代码已提交到Git仓库
- [ ] 已创建Git标签（可选）

### 安全准备
- [ ] 生成强JWT密钥（至少32字符）
- [ ] 生成强数据库密码
- [ ] 修改管理员默认密码
- [ ] 检查敏感信息未提交到Git

### 服务器准备
- [ ] 服务器已购买（ECS/云服务器）
- [ ] 域名已购买并解析
- [ ] 服务器SSH密钥已配置
- [ ] 防火墙规则已配置

---

## 🖥️ 服务器环境

### 基础环境
- [ ] Node.js 20 已安装
- [ ] PostgreSQL 已安装并运行
- [ ] Nginx 已安装并运行
- [ ] PM2 已安装并配置开机自启

### 目录结构
- [ ] `/var/www/forum` 目录已创建
- [ ] `/var/log/forum` 目录已创建
- [ ] `/var/www/forum/uploads` 目录已创建
- [ ] 目录权限已正确设置

---

## 🗄️ 数据库

- [ ] 数据库 `forum` 已创建
- [ ] 用户 `forum_user` 已创建
- [ ] 用户权限已正确配置
- [ ] 数据库迁移已运行
- [ ] 种子数据已运行（管理员账号）

---

## 🔧 后端部署

- [ ] 代码已克隆到服务器
- [ ] 依赖已安装（`npm install --production`）
- [ ] `.env` 文件已配置
- [ ] Prisma Client 已生成
- [ ] 数据库迁移已运行
- [ ] 项目已构建（`npm run build`）
- [ ] PM2 进程已启动
- [ ] PM2 配置已保存（`pm2 save`）
- [ ] API健康检查通过：`http://localhost:3000/api/health`

---

## 🎨 前端部署

### 方案1：Nginx部署
- [ ] 依赖已安装
- [ ] `.env.production` 已配置
- [ ] 项目已构建（`npm run build`）
- [ ] Nginx配置已创建
- [ ] Nginx配置已启用
- [ ] Nginx配置测试通过

### 方案2：OSS部署
- [ ] OSS Bucket已创建
- [ ] 静态网站托管已开启
- [ ] CDN已配置
- [ ] 文件已上传到OSS
- [ ] 域名已绑定

---

## 🌐 Nginx配置

- [ ] 后端API配置已创建
- [ ] 前端配置已创建（如使用Nginx）
- [ ] 配置文件已启用
- [ ] Nginx配置测试通过（`nginx -t`）
- [ ] Nginx已重新加载

---

## 🔒 SSL证书

- [ ] Certbot已安装
- [ ] SSL证书已获取
- [ ] HTTPS配置已更新
- [ ] HTTP到HTTPS重定向已配置
- [ ] 证书自动续期已测试

---

## 📊 监控和日志

- [ ] PM2日志正常
- [ ] Nginx日志正常
- [ ] 应用日志目录已创建
- [ ] 日志轮转已配置（可选）

---

## 💾 备份

- [ ] 备份脚本已创建
- [ ] 备份目录已创建
- [ ] 定时任务已配置
- [ ] 备份脚本已测试
- [ ] 文件备份已配置（可选）

---

## ✅ 功能验证

### 基础功能
- [ ] 前端页面可以访问
- [ ] API可以访问
- [ ] 用户注册功能正常
- [ ] 用户登录功能正常
- [ ] 发帖功能正常
- [ ] 评论功能正常
- [ ] 图片上传功能正常

### 管理员功能
- [ ] 管理员可以登录
- [ ] 管理面板可以访问
- [ ] 帖子管理功能正常
- [ ] 用户管理功能正常
- [ ] 封禁功能正常

### 安全验证
- [ ] HTTPS正常工作
- [ ] 封禁用户无法登录
- [ ] 封禁用户无法访问API
- [ ] CORS配置正确

---

## 🔄 更新流程

- [ ] Git拉取代码流程已测试
- [ ] 数据库迁移流程已测试
- [ ] 重启应用流程已测试
- [ ] 回滚方案已准备（可选）

---

## 📝 文档

- [ ] 部署文档已阅读
- [ ] 环境变量已记录
- [ ] 密码已安全保存
- [ ] 服务器信息已记录

---

## 🎯 完成标准

所有检查项完成后，项目应该：
- ✅ 前端和后端都可以正常访问
- ✅ 所有核心功能正常工作
- ✅ HTTPS证书有效
- ✅ 监控和日志正常
- ✅ 备份策略已实施

---

**提示：** 建议在部署过程中逐项检查，确保每项都完成后再进行下一步。
