# 移动端连接问题排查指南

## 🔍 问题：连接被拒绝

### 常见原因

1. **Vite服务器只监听localhost**
   - 默认情况下，Vite只监听 `127.0.0.1` 或 `::1`
   - 手机无法通过IP地址访问

2. **防火墙阻止**
   - Windows防火墙可能阻止5173端口
   - 需要添加防火墙规则

3. **网络配置问题**
   - 手机和电脑不在同一网络
   - IP地址错误

---

## ✅ 解决方案

### 方案1：配置Vite允许外部访问（已修复）

已更新 `vite.config.ts`，添加了：
```typescript
server: {
  host: '0.0.0.0', // 允许外部访问
  port: 5173,
}
```

**下一步：**
1. 重启开发服务器
2. 查看新的启动信息（应该显示网络地址）

---

### 方案2：配置Windows防火墙

#### 方法A：通过Windows设置

1. 打开"Windows安全中心"
2. 点击"防火墙和网络保护"
3. 点击"高级设置"
4. 点击"入站规则" > "新建规则"
5. 选择"端口" > 下一步
6. 选择"TCP"，输入端口：`5173`
7. 选择"允许连接"
8. 应用到所有配置文件
9. 输入名称："Vite Dev Server"

#### 方法B：通过PowerShell（管理员）

```powershell
# 添加防火墙规则
New-NetFirewallRule -DisplayName "Vite Dev Server" -Direction Inbound -LocalPort 5173 -Protocol TCP -Action Allow
```

---

### 方案3：检查网络连接

#### 1. 确认手机和电脑在同一WiFi

- 手机WiFi设置中查看IP地址
- 电脑IP地址应该在同一网段
  - 例如：手机 `192.168.1.101`，电脑 `192.168.1.100`

#### 2. 获取电脑IP地址

**Windows:**
```powershell
ipconfig
# 查找"IPv4 地址"，例如：192.168.1.100
```

**macOS/Linux:**
```bash
ifconfig
# 或
ip addr show
```

#### 3. 测试连接

在手机上：
1. 打开浏览器
2. 访问：`http://你的IP:5173`
   - 例如：`http://192.168.1.100:5173`

---

## 🔧 详细步骤

### 步骤1：重启开发服务器

```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
cd frontend
npm run dev
```

**应该看到类似输出：**
```
  VITE v7.x.x  ready in xxx ms

  ➜  Local:   http://localhost:5173/
  ➜  Network: http://192.168.1.100:5173/
  ➜  Network: http://[你的IPv6地址]:5173/
```

**重要：** 使用"Network"地址，不是"Local"地址！

### 步骤2：配置防火墙

如果仍然无法连接，配置防火墙：

**Windows防火墙：**
1. 打开"Windows Defender 防火墙"
2. 点击"高级设置"
3. 创建入站规则（端口5173）

**或者临时关闭防火墙测试：**
- 仅用于测试，测试完记得重新开启

### 步骤3：测试连接

#### 在电脑上测试：

```powershell
# 测试本地连接
curl http://localhost:5173

# 测试网络连接（使用你的IP）
curl http://192.168.1.100:5173
```

#### 在手机上测试：

1. 确保手机和电脑在同一WiFi
2. 打开手机浏览器
3. 访问：`http://你的IP:5173`
4. 应该能看到网站

---

## 🐛 故障排查

### 问题1：仍然显示"连接被拒绝"

**检查清单：**
- [ ] Vite配置已更新（host: '0.0.0.0'）
- [ ] 服务器已重启
- [ ] 防火墙已配置
- [ ] 手机和电脑在同一网络
- [ ] IP地址正确

**尝试：**
```bash
# 检查端口是否监听
netstat -ano | findstr :5173

# 应该看到类似：
# TCP    0.0.0.0:5173    0.0.0.0:0    LISTENING
# 而不是：
# TCP    [::1]:5173    0.0.0.0:0    LISTENING
```

### 问题2：防火墙配置后仍无法连接

**尝试：**
1. 临时关闭防火墙测试
2. 检查是否有其他安全软件阻止
3. 尝试使用其他端口

### 问题3：手机和电脑不在同一网络

**解决方案：**
1. **使用手机热点：**
   - 打开手机热点
   - 电脑连接手机热点
   - 使用手机热点分配的IP

2. **使用ngrok（公网访问）：**
   ```bash
   # 安装ngrok
   npm install -g ngrok
   
   # 创建隧道
   ngrok http 5173
   
   # 使用ngrok提供的URL在手机上访问
   ```

---

## ✅ 验证连接

### 成功标志：

1. **Vite启动信息显示Network地址**
   ```
   ➜  Network: http://192.168.1.100:5173/
   ```

2. **在手机上可以访问**
   - 浏览器显示网站内容
   - 没有"连接被拒绝"错误

3. **可以正常使用功能**
   - 页面加载正常
   - 可以点击链接
   - 可以登录注册

---

## 📝 快速检查清单

- [ ] `vite.config.ts` 已配置 `host: '0.0.0.0'`
- [ ] 开发服务器已重启
- [ ] 防火墙已配置（或临时关闭测试）
- [ ] 手机和电脑在同一WiFi
- [ ] 使用Network地址访问（不是localhost）
- [ ] IP地址正确

---

## 💡 提示

1. **使用Network地址：** Vite启动时会显示Network地址，使用这个地址在手机上访问
2. **防火墙：** Windows防火墙默认可能阻止，需要手动配置
3. **同一网络：** 确保手机和电脑在同一WiFi网络
4. **IP变化：** 如果电脑IP地址变化，需要更新手机上的访问地址

---

**如果按照以上步骤仍然无法连接，请告诉我具体的错误信息！**
