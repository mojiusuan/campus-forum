# ç§ä¿¡æ¨¡å—APIå®ç°å®Œæˆ

## âœ… å®Œæˆæ—¶é—´
2026-02-06

---

## ğŸ“‹ å®ç°æ¸…å•

### 1. ç§ä¿¡æ§åˆ¶å™¨ âœ…
- [x] åˆ›å»º `src/controllers/message.controller.ts`
- [x] å®ç°è·å–å¯¹è¯åˆ—è¡¨åŠŸèƒ½
- [x] å®ç°è·å–å¯¹è¯è¯¦æƒ…åŠŸèƒ½
- [x] å®ç°å‘é€æ¶ˆæ¯åŠŸèƒ½
- [x] å®ç°æ ‡è®°æ¶ˆæ¯å·²è¯»åŠŸèƒ½
- [x] å®ç°è·å–æœªè¯»æ¶ˆæ¯æ•°åŠŸèƒ½

### 2. ç§ä¿¡è·¯ç”± âœ…
- [x] åˆ›å»º `src/routes/messages.routes.ts`
- [x] å®šä¹‰5ä¸ªAPIè·¯ç”±
- [x] é›†æˆè®¤è¯ä¸­é—´ä»¶
- [x] æ³¨å†Œåˆ°ä¸»åº”ç”¨

### 3. åŠŸèƒ½ç‰¹æ€§ âœ…
- [x] å¯¹è¯åˆ—è¡¨ï¼ˆæ˜¾ç¤ºæ‰€æœ‰å¯¹è¯ï¼ŒåŒ…å«æœ€åä¸€æ¡æ¶ˆæ¯å’Œæœªè¯»æ•°ï¼‰
- [x] å¯¹è¯è¯¦æƒ…ï¼ˆä¸ç‰¹å®šç”¨æˆ·çš„æ¶ˆæ¯åˆ—è¡¨ï¼Œæ”¯æŒåˆ†é¡µï¼‰
- [x] å‘é€æ¶ˆæ¯ï¼ˆæ”¯æŒæ–‡æœ¬å’Œå›¾ç‰‡ï¼‰
- [x] æ ‡è®°æ¶ˆæ¯å·²è¯»
- [x] æœªè¯»æ¶ˆæ¯ç»Ÿè®¡
- [x] æƒé™éªŒè¯ï¼ˆéœ€è¦ç™»å½•ï¼‰
- [x] æ•°æ®éªŒè¯ï¼ˆå†…å®¹é•¿åº¦ã€ä¸èƒ½ç»™è‡ªå·±å‘æ¶ˆæ¯ï¼‰

---

## ğŸ”Œ APIæ¥å£

### 1. è·å–å¯¹è¯åˆ—è¡¨
```
GET /api/conversations
```

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "conversations": [
      {
        "userId": "uuid",
        "username": "username",
        "avatarUrl": "https://...",
        "lastMessage": {
          "content": "æœ€åä¸€æ¡æ¶ˆæ¯",
          "createdAt": "2026-02-06T..."
        },
        "unreadCount": 2
      }
    ]
  }
}
```

### 2. è·å–å¯¹è¯è¯¦æƒ…
```
GET /api/conversations/:userId
```

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**æŸ¥è¯¢å‚æ•°ï¼š**
- `page` - é¡µç ï¼ˆé»˜è®¤1ï¼‰
- `limit` - æ¯é¡µæ•°é‡ï¼ˆé»˜è®¤20ï¼‰

**å“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "username": "username",
      "avatarUrl": "https://..."
    },
    "messages": [
      {
        "id": "uuid",
        "content": "æ¶ˆæ¯å†…å®¹",
        "imageUrl": "https://...",
        "isRead": true,
        "readAt": "2026-02-06T...",
        "createdAt": "2026-02-06T...",
        "sender": {
          "id": "uuid",
          "username": "username",
          "avatarUrl": "https://..."
        },
        "isOwn": true
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 50,
      "totalPages": 3,
      "hasNext": true,
      "hasPrev": false
    }
  }
}
```

### 3. å‘é€æ¶ˆæ¯
```
POST /api/conversations/:userId/messages
```

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "content": "æ¶ˆæ¯å†…å®¹",
  "imageUrl": "https://..." // å¯é€‰
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "æ¶ˆæ¯å‘é€æˆåŠŸ",
  "data": {
    "id": "uuid",
    "content": "æ¶ˆæ¯å†…å®¹",
    "imageUrl": "https://...",
    "isRead": false,
    "createdAt": "2026-02-06T...",
    "sender": {
      "id": "uuid",
      "username": "username",
      "avatarUrl": "https://..."
    }
  }
}
```

### 4. æ ‡è®°æ¶ˆæ¯å·²è¯»
```
PUT /api/messages/:id/read
```

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "æ¶ˆæ¯å·²æ ‡è®°ä¸ºå·²è¯»",
  "data": {
    "id": "uuid",
    "isRead": true,
    "readAt": "2026-02-06T..."
  }
}
```

### 5. è·å–æœªè¯»æ¶ˆæ¯æ•°
```
GET /api/messages/unread-count
```

**è¯·æ±‚å¤´ï¼š**
```
Authorization: Bearer <token>
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "data": {
    "unreadCount": 5
  }
}
```

---

## ğŸ¯ å®ç°ç»†èŠ‚

### å¯¹è¯åˆ—è¡¨é€»è¾‘
- è·å–å½“å‰ç”¨æˆ·å‘é€å’Œæ¥æ”¶çš„æ‰€æœ‰æ¶ˆæ¯
- æŒ‰å¯¹æ–¹ç”¨æˆ·åˆ†ç»„ï¼Œæ„å»ºå¯¹è¯æ˜ å°„
- æ¯ä¸ªå¯¹è¯æ˜¾ç¤ºï¼š
  - å¯¹æ–¹ç”¨æˆ·ä¿¡æ¯ï¼ˆIDã€ç”¨æˆ·åã€å¤´åƒï¼‰
  - æœ€åä¸€æ¡æ¶ˆæ¯ï¼ˆå†…å®¹å’Œæ—¶é—´ï¼‰
  - æœªè¯»æ¶ˆæ¯æ•°ï¼ˆä»…ç»Ÿè®¡æ¥æ”¶çš„æœªè¯»æ¶ˆæ¯ï¼‰
- æŒ‰æœ€åæ¶ˆæ¯æ—¶é—´æ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰

### å¯¹è¯è¯¦æƒ…é€»è¾‘
- è·å–ä¸ç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰æ¶ˆæ¯
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢
- æ¶ˆæ¯æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨æœ€åï¼‰
- æ ‡è®°æ¯æ¡æ¶ˆæ¯æ˜¯å¦ä¸ºè‡ªå·±å‘é€ï¼ˆisOwnï¼‰

### å‘é€æ¶ˆæ¯é€»è¾‘
- éªŒè¯æ¶ˆæ¯å†…å®¹æˆ–å›¾ç‰‡ä¸èƒ½åŒæ—¶ä¸ºç©º
- éªŒè¯æ¶ˆæ¯å†…å®¹é•¿åº¦ï¼ˆæœ€å¤§5000å­—ç¬¦ï¼‰
- éªŒè¯æ¥æ”¶è€…å­˜åœ¨ä¸”æœªè¢«ç¦ç”¨
- é˜²æ­¢ç»™è‡ªå·±å‘æ¶ˆæ¯
- åˆ›å»ºæ¶ˆæ¯è®°å½•

### æ ‡è®°å·²è¯»é€»è¾‘
- åªèƒ½æ ‡è®°è‡ªå·±æ¥æ”¶çš„æ¶ˆæ¯
- å¦‚æœå·²è¯»ï¼Œç›´æ¥è¿”å›
- æ›´æ–°isReadå’ŒreadAtå­—æ®µ

### æœªè¯»æ¶ˆæ¯ç»Ÿè®¡
- ç»Ÿè®¡å½“å‰ç”¨æˆ·æ¥æ”¶çš„æ‰€æœ‰æœªè¯»æ¶ˆæ¯
- ç”¨äºæ˜¾ç¤ºæœªè¯»æ¶ˆæ¯æ•°æç¤º

---

## ğŸ“Š APIç»Ÿè®¡

### å·²å®ç°æ¥å£ï¼ˆ21/39ï¼‰
- âœ… è®¤è¯æ¨¡å—ï¼ˆ4ä¸ªï¼‰
- âœ… ç”¨æˆ·æ¨¡å—ï¼ˆ2ä¸ªï¼‰
- âœ… å¸–å­æ¨¡å—ï¼ˆ5ä¸ªï¼‰
- âœ… åˆ†ç±»æ¨¡å—ï¼ˆ1ä¸ªï¼‰
- âœ… è¯„è®ºæ¨¡å—ï¼ˆ4ä¸ªï¼‰
- âœ… äº’åŠ¨æ¨¡å—ï¼ˆ6ä¸ªï¼‰
- âœ… ç§ä¿¡æ¨¡å—ï¼ˆ5ä¸ªï¼‰â† æ–°å¢

### å¾…å®ç°æ¥å£ï¼ˆ18ä¸ªï¼‰
- â­ï¸ å­¦ä¹ èµ„æ–™æ¨¡å—ï¼ˆ3ä¸ªï¼‰
- â­ï¸ å…³æ³¨æ¨¡å—ï¼ˆ4ä¸ªï¼‰
- â­ï¸ é€šçŸ¥æ¨¡å—ï¼ˆ4ä¸ªï¼‰
- â­ï¸ æœç´¢æ¨¡å—ï¼ˆ1ä¸ªï¼‰
- â­ï¸ æ–‡ä»¶ä¸Šä¼ ï¼ˆ2ä¸ªï¼‰

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ä¼˜å…ˆçº§1ï¼šå®ç°å…³æ³¨æ¨¡å—API
- POST /api/users/:id/follow - å…³æ³¨ç”¨æˆ·
- DELETE /api/users/:id/follow - å–æ¶ˆå…³æ³¨
- GET /api/users/:id/following - è·å–å…³æ³¨åˆ—è¡¨
- GET /api/users/:id/followers - è·å–ç²‰ä¸åˆ—è¡¨

### ä¼˜å…ˆçº§2ï¼šå®ç°é€šçŸ¥æ¨¡å—API
- GET /api/notifications - è·å–é€šçŸ¥åˆ—è¡¨
- PUT /api/notifications/:id/read - æ ‡è®°å·²è¯»
- PUT /api/notifications/read-all - æ ‡è®°å…¨éƒ¨å·²è¯»
- GET /api/notifications/unread-count - è·å–æœªè¯»æ•°

### ä¼˜å…ˆçº§3ï¼šå®ç°æœç´¢æ¨¡å—API
- GET /api/search - æœç´¢å¸–å­ã€ç”¨æˆ·ã€èµ„æ–™

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2026-02-06  
**çŠ¶æ€ï¼š** âœ… ç§ä¿¡æ¨¡å—APIå®ç°å®Œæˆï¼ˆP1åŠŸèƒ½ï¼‰
